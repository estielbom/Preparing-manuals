<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>××—×•×œ×œ ××“×¨×™×›×™× ××™× ×˜×¨××§×˜×™×‘×™</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            direction: rtl;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        h1 {
            color: #2563eb;
            margin-bottom: 10px;
            font-size: 32px;
        }
        .subtitle {
            color: #6b7280;
            margin-bottom: 30px;
            font-size: 16px;
        }
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e5e7eb;
            flex-wrap: wrap;
        }
        .tab {
            padding: 12px 24px;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 16px;
            font-weight: 500;
            color: #6b7280;
            border-bottom: 3px solid transparent;
            transition: all 0.2s;
        }
        .tab.active {
            color: #2563eb;
            border-bottom-color: #2563eb;
        }
        .tab:hover {
            color: #2563eb;
        }
        .section {
            display: none;
        }
        .section.active {
            display: block;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #374151;
        }
        input, textarea, select {
            width: 100%;
            padding: 12px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
        }
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        button {
            padding: 12px 24px;
            background: #2563eb;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        button:hover {
            background: #1d4ed8;
            transform: translateY(-1px);
        }
        button.secondary {
            background: #6b7280;
        }
        button.secondary:hover {
            background: #4b5563;
        }
        button.danger {
            background: #dc2626;
        }
        button.danger:hover {
            background: #b91c1c;
        }
        .screen-list {
            margin-top: 20px;
        }
        .screen-item {
            background: #f9fafb;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .screen-item h3 {
            color: #111827;
            font-size: 16px;
        }
        .screen-item .category {
            color: #6b7280;
            font-size: 14px;
        }
        .screen-actions {
            display: flex;
            gap: 10px;
        }
        .screen-actions button {
            padding: 8px 16px;
            font-size: 13px;
        }
        .preview-image {
            max-width: 200px;
            max-height: 150px;
            border-radius: 8px;
            margin-top: 10px;
        }
        .emoji-picker {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 10px;
        }
        .emoji-btn {
            padding: 10px;
            font-size: 24px;
            background: #f3f4f6;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .emoji-btn:hover, .emoji-btn.selected {
            background: #dbeafe;
            border-color: #2563eb;
        }
        .export-section {
            background: #f0fdf4;
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #86efac;
        }
        .export-section h2 {
            color: #166534;
            margin-bottom: 10px;
        }
        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .alert-info {
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #93c5fd;
        }
        .file-upload {
            border: 2px dashed #d1d5db;
            padding: 30px;
            text-align: center;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .file-upload:hover {
            border-color: #2563eb;
            background: #f0f9ff;
        }
        .shape-editor {
            background: #f9fafb;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
        }
        .shape-editor h3 {
            color: #111827;
            margin-bottom: 15px;
            font-size: 18px;
        }
        .canvas-container {
            position: relative;
            background: white;
            border: 2px solid #d1d5db;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 20px;
            max-width: 100%;
        }
        #shape-canvas {
            display: block;
            max-width: 100%;
            height: auto;
            cursor: crosshair;
        }
        .shape-tools {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }
        .tool-btn {
            padding: 10px 16px;
            background: white;
            border: 2px solid #d1d5db;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
        }
        .tool-btn:hover {
            border-color: #2563eb;
            background: #eff6ff;
        }
        .tool-btn.active {
            background: #2563eb;
            color: white;
            border-color: #2563eb;
        }
        .color-picker-group {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        .color-option {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.2s;
        }
        .color-option:hover, .color-option.selected {
            border-color: #111827;
            transform: scale(1.1);
        }
        .animation-controls {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        .shape-list {
            background: white;
            padding: 15px;
            border-radius: 8px;
            max-height: 200px;
            overflow-y: auto;
        }
        .shape-item-editor {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            margin-bottom: 5px;
            background: #f9fafb;
            border-radius: 6px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¨ ××—×•×œ×œ ××“×¨×™×›×™× ××™× ×˜×¨××§×˜×™×‘×™</h1>
        <p class="subtitle">×¦×¨×™ ××“×¨×™×›×™× ××§×¦×•×¢×™×™× ×¢× ×ª××•× ×•×ª, ×¦×•×¨×•×ª ××•× ×¤×©×•×ª ×•× ×§×•×“×•×ª ××¤×ª×—!</p>

        <div class="tabs">
            <button class="tab active" data-tab="add">â• ×”×•×¡×¤×ª ××¡×š</button>
            <button class="tab" data-tab="screens">ğŸ“‹ ×¨×©×™××ª ××¡×›×™×</button>
            <button class="tab" data-tab="settings">âš™ï¸ ×”×’×“×¨×•×ª</button>
            <button class="tab" data-tab="export">ğŸš€ ×™×™×¦×•×</button>
        </div>

        <div id="add-section" class="section active">
            <h2 style="margin-bottom: 20px;">â• ×”×•×¡×™×¤×™ ××¡×š ×—×“×©</h2>
            
            <div class="form-group">
                <label>×›×•×ª×¨×ª ×”××¡×š</label>
                <input type="text" id="screen-title" placeholder="×œ×“×•×’××”: ×“×£ ×”×‘×™×ª - ×“×•×’××” 1">
            </div>

            <div class="form-group">
                <label>×§×˜×’×•×¨×™×”</label>
                <input type="text" id="screen-category" placeholder="×œ×“×•×’××”: ×“×£ ×”×‘×™×ª, ××™×¨×•×¢×™×, ×¤×¢×•×œ×•×ª...">
            </div>

            <div class="form-group">
                <label>×‘×—×¨×™ ××™×™×§×•×Ÿ</label>
                <div class="emoji-picker">
                    <button class="emoji-btn selected" data-emoji="ğŸ ">ğŸ </button>
                    <button class="emoji-btn" data-emoji="ğŸ“Š">ğŸ“Š</button>
                    <button class="emoji-btn" data-emoji="ğŸ“ˆ">ğŸ“ˆ</button>
                    <button class="emoji-btn" data-emoji="ğŸ“‹">ğŸ“‹</button>
                    <button class="emoji-btn" data-emoji="ğŸ“">ğŸ“</button>
                    <button class="emoji-btn" data-emoji="ğŸ“„">ğŸ“„</button>
                    <button class="emoji-btn" data-emoji="ğŸ‘¤">ğŸ‘¤</button>
                    <button class="emoji-btn" data-emoji="ğŸ¢">ğŸ¢</button>
                    <button class="emoji-btn" data-emoji="âœ…">âœ…</button>
                    <button class="emoji-btn" data-emoji="ğŸ“…">ğŸ“…</button>
                    <button class="emoji-btn" data-emoji="ğŸ“">ğŸ“</button>
                    <button class="emoji-btn" data-emoji="ğŸ’³">ğŸ’³</button>
                    <button class="emoji-btn" data-emoji="ğŸ‘¥">ğŸ‘¥</button>
                    <button class="emoji-btn" data-emoji="â­">â­</button>
                    <button class="emoji-btn" data-emoji="ğŸ¯">ğŸ¯</button>
                    <button class="emoji-btn" data-emoji="â“">â“</button>
                </div>
            </div>

            <div class="form-group">
                <label>×¡×•×’ ×”×ª×•×›×Ÿ</label>
                <select id="content-type">
                    <option value="image">×ª××•× ×” + × ×§×•×“×•×ª</option>
                    <option value="text">×˜×§×¡×˜ ×‘×œ×‘×“</option>
                </select>
            </div>

            <div class="form-group" id="image-upload-section">
                <label>×”×¢×œ××ª ×ª××•× ×”</label>
                <div class="file-upload" id="file-upload-zone">
                    <p>ğŸ“¸ ×œ×—×¦×™ ×›××Ÿ ×œ×”×¢×œ××ª ×ª××•× ×”</p>
                    <input type="file" id="image-input" accept="image/*" style="display: none;">
                </div>
                <img id="preview" class="preview-image" style="display: none;">
                
                <div class="shape-editor" id="shape-editor" style="display: none;">
                    <h3>ğŸ¨ ×¢×¨×™×›×ª ×ª××•× ×” - ×”×•×¡×¤×ª ×¦×•×¨×•×ª ×•×”× ×¤×©×•×ª</h3>
                    
                    <div class="shape-tools">
                        <button class="tool-btn" data-tool="arrow">â¡ï¸ ×—×¥</button>
                        <button class="tool-btn" data-tool="rect">â¬œ ××œ×‘×Ÿ</button>
                        <button class="tool-btn" data-tool="circle">â­• ×¢×™×’×•×œ</button>
                        <button class="tool-btn" data-tool="text">ğŸ“ ×˜×§×¡×˜</button>
                        <button class="tool-btn danger" id="clear-shapes">ğŸ—‘ï¸ × ×§×” ×”×›×œ</button>
                    </div>

                    <div class="color-picker-group">
                        <label>×‘×—×¨×™ ×¦×‘×¢:</label>
                        <div class="color-option" data-color="#ef4444" style="background: #ef4444;"></div>
                        <div class="color-option" data-color="#f59e0b" style="background: #f59e0b;"></div>
                        <div class="color-option" data-color="#10b981" style="background: #10b981;"></div>
                        <div class="color-option selected" data-color="#3b82f6" style="background: #3b82f6;"></div>
                        <div class="color-option" data-color="#8b5cf6" style="background: #8b5cf6;"></div>
                        <div class="color-option" data-color="#ec4899" style="background: #ec4899;"></div>
                    </div>

                    <div class="animation-controls">
                        <label>
                            <input type="checkbox" id="enable-animation">
                            ×”×¤×¢×œ ×”× ×¤×©×” (×¤×¢×™××”)
                        </label>
                    </div>

                    <div class="canvas-container">
                        <canvas id="shape-canvas"></canvas>
                    </div>

                    <div class="shape-list" id="shape-list">
                        <p style="color: #6b7280; text-align: center;">××™×Ÿ ×¦×•×¨×•×ª ×¢×“×™×™×Ÿ</p>
                    </div>
                </div>
            </div>

            <div class="form-group" id="text-content-section" style="display: none;">
                <label>×ª×•×›×Ÿ ×˜×§×¡×˜</label>
                <textarea id="screen-text-content" placeholder="×”×›× ×¡ ×˜×§×¡×˜ ×©×™×•×¦×’ ×‘××§×•× ×”×ª××•× ×”..."></textarea>
            </div>

            <div class="form-group">
                <label>× ×§×•×“×•×ª ××¤×ª×— (×›×œ × ×§×•×“×” ×‘×©×•×¨×” × ×¤×¨×“×ª)</label>
                <textarea id="screen-points" placeholder="× ×§×•×“×” ×¨××©×•× ×”
× ×§×•×“×” ×©× ×™×™×”
× ×§×•×“×” ×©×œ×™×©×™×ª"></textarea>
            </div>

            <button id="add-screen-btn">â• ×”×•×¡×£ ××¡×š</button>
        </div>

        <div id="screens-section" class="section">
            <h2 style="margin-bottom: 20px;">ğŸ“‹ ×”××¡×›×™× ×©×œ×š</h2>
            <div id="screens-list" class="screen-list">
                <p style="color: #6b7280; text-align: center; padding: 40px;">××™×Ÿ ××¡×›×™× ×¢×“×™×™×Ÿ. ×”×•×¡×™×¤×™ ××ª ×”××¡×š ×”×¨××©×•×Ÿ! ğŸ¨</p>
            </div>
        </div>

        <div id="settings-section" class="section">
            <h2 style="margin-bottom: 20px;">âš™ï¸ ×”×’×“×¨×•×ª ×›×œ×œ×™×•×ª</h2>
            
            <div class="form-group">
                <label>×›×•×ª×¨×ª ×”××“×¨×™×š</label>
                <input type="text" id="guide-title" value="××“×¨×™×š ××™× ×˜×¨××§×˜×™×‘×™">
            </div>

            <div class="form-group">
                <label>×ª×ª-×›×•×ª×¨×ª</label>
                <input type="text" id="guide-subtitle" value="××¢×¨×›×ª CRM - Microsoft Dynamics 365">
            </div>

            <div class="form-group">
                <label>×œ×•×’×• 1 (URL ××• ×”×¢×œ××”)</label>
                <input type="text" id="logo1-url" placeholder="https://...">
                <input type="file" id="logo1-file" accept="image/*" style="margin-top: 10px;">
            </div>

            <div class="form-group">
                <label>×œ×•×’×• 2 (URL ××• ×”×¢×œ××”)</label>
                <input type="text" id="logo2-url" placeholder="https://...">
                <input type="file" id="logo2-file" accept="image/*" style="margin-top: 10px;">
            </div>

            <button id="save-settings-btn">ğŸ’¾ ×©××•×¨ ×”×’×“×¨×•×ª</button>
        </div>

        <div id="export-section" class="section">
            <div class="export-section">
                <h2>ğŸš€ ×™×™×¦×•× ×”××“×¨×™×š</h2>
                <p style="margin-bottom: 20px; color: #166534;">×”××“×¨×™×š ×©×œ×š ××•×›×Ÿ! ×œ×—×¦×™ ×¢×œ ×”×›×¤×ª×•×¨ ×œ×”×•×¨×“×”.</p>
                <button id="export-btn">â¬‡ï¸ ×”×•×¨×“ ××ª ×”××“×¨×™×š (HTML)</button>
            </div>

            <div class="alert alert-info" style="margin-top: 20px;">
                <strong>ğŸ’¡ ××” ×¢×•×©×™× ×¢× ×”×§×•×‘×¥?</strong><br>
                1. ×©××¨×™ ××ª ×”×§×•×‘×¥ ×‘××—×©×‘<br>
                2. ×”×¢×œ×™ ××•×ª×• ×œ-GitHub Pages<br>
                3. ×©×œ×—×™ ××ª ×”×§×™×©×•×¨!
            </div>
        </div>
    </div>

    <script>
        var screens = [];
        var selectedEmoji = 'ğŸ ';
        var settings = {
            title: '××“×¨×™×š ××™× ×˜×¨××§×˜×™×‘×™',
            subtitle: '××¢×¨×›×ª CRM - Microsoft Dynamics 365',
            logo1: '',
            logo2: ''
        };
        var canvas, ctx, baseImage = null, shapes = [];
        var currentTool = null, currentColor = '#3b82f6';
        var isDrawing = false, startX, startY;

        // Tabs
        document.querySelectorAll('.tab').forEach(function(tab) {
            tab.onclick = function() {
                var tabId = this.getAttribute('data-tab');
                document.querySelectorAll('.tab').forEach(function(t) { t.classList.remove('active'); });
                document.querySelectorAll('.section').forEach(function(s) { s.classList.remove('active'); });
                this.classList.add('active');
                document.getElementById(tabId + '-section').classList.add('active');
                if (tabId === 'screens') renderScreensList();
            };
        });

        // Emojis
        document.querySelectorAll('.emoji-btn').forEach(function(btn) {
            btn.onclick = function() {
                selectedEmoji = this.getAttribute('data-emoji');
                document.querySelectorAll('.emoji-btn').forEach(function(b) { b.classList.remove('selected'); });
                this.classList.add('selected');
            };
        });

        // Content type
        document.getElementById('content-type').onchange = function() {
            var type = this.value;
            if (type === 'image') {
                document.getElementById('image-upload-section').style.display = 'block';
                document.getElementById('text-content-section').style.display = 'none';
            } else {
                document.getElementById('image-upload-section').style.display = 'none';
                document.getElementById('text-content-section').style.display = 'block';
            }
        };

        // File upload
        document.getElementById('file-upload-zone').onclick = function() {
            document.getElementById('image-input').click();
        };

        document.getElementById('image-input').onchange = function(e) {
            var file = e.target.files[0];
            if (file) {
                var reader = new FileReader();
                reader.onload = function(event) {
                    var preview = document.getElementById('preview');
                    preview.src = event.target.result;
                    preview.style.display = 'block';
                    document.getElementById('shape-editor').style.display = 'block';
                    initCanvas(event.target.result);
                };
                reader.readAsDataURL(file);
            }
        };

        // Canvas init
        function initCanvas(imageSrc) {
            canvas = document.getElementById('shape-canvas');
            ctx = canvas.getContext('2d');
            var img = new Image();
            img.onload = function() {
                var maxWidth = 800;
                var scale = Math.min(maxWidth / img.width, 1);
                canvas.width = img.width * scale;
                canvas.height = img.height * scale;
                baseImage = img;
                shapes = [];
                redrawCanvas();
            };
            img.src = imageSrc;

            canvas.onmousedown = function(e) {
                if (!currentTool) return;
                var rect = canvas.getBoundingClientRect();
                startX = e.clientX - rect.left;
                startY = e.clientY - rect.top;
                isDrawing = true;

                if (currentTool === 'text') {
                    var text = prompt('×”×›× ×¡ ×˜×§×¡×˜:');
                    if (text) {
                        shapes.push({
                            type: 'text',
                            x: startX,
                            y: startY,
                            text: text,
                            color: currentColor,
                            animated: document.getElementById('enable-animation').checked
                        });
                        redrawCanvas();
                        updateShapeList();
                    }
                    isDrawing = false;
                }
            };

            canvas.onmousemove = function(e) {
                if (!isDrawing || currentTool === 'text') return;
                var rect = canvas.getBoundingClientRect();
                var currentX = e.clientX - rect.left;
                var currentY = e.clientY - rect.top;
                redrawCanvas();
                drawPreview(startX, startY, currentX, currentY);
            };

            canvas.onmouseup = function(e) {
                if (!isDrawing || currentTool === 'text') return;
                var rect = canvas.getBoundingClientRect();
                var endX = e.clientX - rect.left;
                var endY = e.clientY - rect.top;
                shapes.push({
                    type: currentTool,
                    x1: startX,
                    y1: startY,
                    x2: endX,
                    y2: endY,
                    color: currentColor,
                    animated: document.getElementById('enable-animation').checked
                });
                isDrawing = false;
                redrawCanvas();
                updateShapeList();
            };
        }

        // Tools
        document.querySelectorAll('[data-tool]').forEach(function(btn) {
            btn.onclick = function() {
                currentTool = this.getAttribute('data-tool');
                document.querySelectorAll('.tool-btn').forEach(function(b) { b.classList.remove('active'); });
                this.classList.add('active');
            };
        });

        // Colors
        document.querySelectorAll('.color-option').forEach(function(opt) {
            opt.onclick = function() {
                currentColor = this.getAttribute('data-color');
                document.querySelectorAll('.color-option').forEach(function(c) { c.classList.remove('selected'); });
                this.classList.add('selected');
            };
        });

        // Clear shapes
        document.getElementById('clear-shapes').onclick = function() {
            if (confirm('×œ××—×•×§ ××ª ×›×œ ×”×¦×•×¨×•×ª?')) {
                shapes = [];
                redrawCanvas();
                updateShapeList();
            }
        };

        function drawPreview(x1, y1, x2, y2) {
            ctx.strokeStyle = currentColor;
            ctx.lineWidth = 3;
            ctx.fillStyle = currentColor + '40';
            if (currentTool === 'arrow') {
                drawArrow(x1, y1, x2, y2);
            } else if (currentTool === 'rect') {
                ctx.strokeRect(x1, y1, x2 - x1, y2 - y1);
                ctx.fillRect(x1, y1, x2 - x1, y2 - y1);
            } else if (currentTool === 'circle') {
                var radius = Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));
                ctx.beginPath();
                ctx.arc(x1, y1, radius, 0, Math.PI * 2);
                ctx.stroke();
                ctx.fill();
            }
        }

        function drawArrow(x1, y1, x2, y2) {
            var headlen = 15;
            var angle = Math.atan2(y2 - y1, x2 - x1);
            ctx.beginPath();
            ctx.moveTo(x1, y1);
            ctx.lineTo(x2, y2);
            ctx.lineTo(x2 - headlen * Math.cos(angle - Math.PI / 6), y2 - headlen * Math.sin(angle - Math.PI / 6));
            ctx.moveTo(x2, y2);
            ctx.lineTo(x2 - headlen * Math.cos(angle + Math.PI / 6), y2 - headlen * Math.sin(angle + Math.PI / 6));
            ctx.stroke();
        }

        function redrawCanvas() {
            if (!baseImage) return;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.drawImage(baseImage, 0, 0, canvas.width, canvas.height);
            shapes.forEach(function(shape) {
                ctx.strokeStyle = shape.color;
                ctx.fillStyle = shape.color + '40';
                ctx.lineWidth = 3;
                ctx.font = '20px Arial';
                if (shape.type === 'arrow') {
                    drawArrow(shape.x1, shape.y1, shape.x2, shape.y2);
                } else if (shape.type === 'rect') {
                    ctx.strokeRect(shape.x1, shape.y1, shape.x2 - shape.x1, shape.y2 - shape.y1);
                    ctx.fillRect(shape.x1, shape.y1, shape.x2 - shape.x1, shape.y2 - shape.y1);
                } else if (shape.type === 'circle') {
                    var radius = Math.sqrt(Math.pow(shape.x2 - shape.x1, 2) + Math.pow(shape.y2 - shape.y1, 2));
                    ctx.beginPath();
                    ctx.arc(shape.x1, shape.y1, radius, 0, Math.PI * 2);
                    ctx.stroke();
                    ctx.fill();
                } else if (shape.type === 'text') {
                    ctx.fillStyle = shape.color;
                    ctx.fillText(shape.text, shape.x, shape.y);
                }
            });
        }

        function updateShapeList() {
            var list = document.getElementById('shape-list');
            if (shapes.length === 0) {
                list.innerHTML = '<p style="color: #6b7280; text-align: center;">××™×Ÿ ×¦×•×¨×•×ª ×¢×“×™×™×Ÿ</p>';
                return;
            }
            list.innerHTML = '<strong style="display: block; margin-bottom: 10px;">×¦×•×¨×•×ª ×©× ×•×¡×¤×•:</strong>';
            shapes.forEach(function(shape, i) {
                var icon = shape.type === 'arrow' ? 'â¡ï¸' : shape.type === 'rect' ? 'â¬œ' : shape.type === 'circle' ? 'â­•' : 'ğŸ“';
                var div = document.createElement('div');
                div.className = 'shape-item-editor';
                div.innerHTML = '<span>' + icon + ' ' + shape.type + (shape.animated ? ' âœ¨ ××•× ×¤×©' : '') + '</span>' +
                               '<button class="danger" onclick="deleteShape(' + i + ')">××—×§</button>';
                list.appendChild(div);
            });
        }

        function deleteShape(index) {
            shapes.splice(index, 1);
            redrawCanvas();
            updateShapeList();
        }

        // Add screen
        document.getElementById('add-screen-btn').onclick = function() {
            var title = document.getElementById('screen-title').value;
            var category = document.getElementById('screen-category').value;
            var contentType = document.getElementById('content-type').value;
            var points = document.getElementById('screen-points').value.split('\n').filter(function(p) { return p.trim(); });
            
            if (!title || !category) {
                alert('×× × ××œ××™ ×œ×¤×—×•×ª ×›×•×ª×¨×ª ×•×§×˜×’×•×¨×™×”');
                return;
            }

            var screen = {
                id: screens.length + 1,
                title: title,
                category: category,
                icon: selectedEmoji,
                content: points
            };

            if (contentType === 'image' && canvas && baseImage) {
                screen.image = canvas.toDataURL('image/png');
                screen.shapes = JSON.parse(JSON.stringify(shapes));
            } else if (contentType === 'text') {
                screen.textContent = document.getElementById('screen-text-content').value;
            }

            screens.push(screen);
            
            document.getElementById('screen-title').value = '';
            document.getElementById('screen-points').value = '';
            document.getElementById('screen-text-content').value = '';
            document.getElementById('preview').style.display = 'none';
            document.getElementById('image-input').value = '';
            document.getElementById('shape-editor').style.display = 'none';
            shapes = [];
            baseImage = null;
            
            alert('âœ… ×”××¡×š × ×•×¡×£ ×‘×”×¦×œ×—×”!');
        };

        function renderScreensList() {
            var list = document.getElementById('screens-list');
            if (screens.length === 0) {
                list.innerHTML = '<p style="color: #6b7280; text-align: center; padding: 40px;">××™×Ÿ ××¡×›×™× ×¢×“×™×™×Ÿ. ğŸ¨</p>';
                return;
            }
            list.innerHTML = '';
            screens.forEach(function(screen, index) {
                var div = document.createElement('div');
                div.className = 'screen-item';
                div.innerHTML = '<div><h3>' + screen.icon + ' ' + screen.title + '</h3>' +
                               '<p class="category">ğŸ“ ' + screen.category + '</p></div>' +
                               '<div class="screen-actions">' +
                               '<button class="secondary" onclick="moveScreen(' + index + ',-1)" ' + (index === 0 ? 'disabled' : '') + '>â¬†ï¸</button>' +
                               '<button class="secondary" onclick="moveScreen(' + index + ',1)" ' + (index === screens.length-1 ? 'disabled' : '') + '>â¬‡ï¸</button>' +
                               '<button class="danger" onclick="deleteScreen(' + index + ')">ğŸ—‘ï¸</button>' +
                               '</div>';
                list.appendChild(div);
            });
        }

        function moveScreen(index, dir) {
            var newIndex = index + dir;
            if (newIndex < 0 || newIndex >= screens.length) return;
            var temp = screens[index];
            screens[index] = screens[newIndex];
            screens[newIndex] = temp;
            screens.forEach(function(s, i) { s.id = i + 1; });
            renderScreensList();
        }

        function deleteScreen(index) {
            if (confirm('×œ××—×•×§ ××¡×š ×–×”?')) {
                screens.splice(index, 1);
                screens.forEach(function(s, i) { s.id = i + 1; });
                renderScreensList();
            }
        }

        // Settings
        document.getElementById('save-settings-btn').onclick = async function() {
            settings.title = document.getElementById('guide-title').value;
            settings.subtitle = document.getElementById('guide-subtitle').value;
            
            var logo1File = document.getElementById('logo1-file').files[0];
            var logo2File = document.getElementById('logo2-file').files[0];
            
            if (logo1File) {
                settings.logo1 = await fileToBase64(logo1File);
            } else {
                settings.logo1 = document.getElementById('logo1-url').value;
            }
            
            if (logo2File) {
                settings.logo2 = await fileToBase64(logo2File);
            } else {
                settings.logo2 = document.getElementById('logo2-url').value;
            }
            
            alert('âœ… ×”×”×’×“×¨×•×ª × ×©××¨×•!');
        };

        function fileToBase64(file) {
            return new Promise(function(resolve) {
                var reader = new FileReader();
                reader.onload = function(e) { resolve(e.target.result); };
                reader.readAsDataURL(file);
            });
        }

        // Export
        document.getElementById('export-btn').onclick = function() {
            if (screens.length === 0) {
                alert('××™×Ÿ ××¡×›×™×! ×”×•×¡×™×¤×™ ×œ×¤×—×•×ª ××¡×š ××—×“.');
                return;
            }
            var html = generateHTML();
            var blob = new Blob([html], { type: 'text/html' });
            var url = URL.createObjectURL(blob);
            var a = document.createElement('a');
            a.href = url;
            a.download = 'index.html';
            a.click();
            URL.revokeObjectURL(url);
            alert('ğŸ‰ ×”×§×•×‘×¥ ×”×•×¨×“!');
        };

        function generateHTML() {
            var screensJSON = JSON.stringify(screens, null, 4);
            
            var html = '<!DOCTYPE html>\n';
            html += '<html lang="he" dir="rtl">\n';
            html += '<head>\n';
            html += '    <meta charset="UTF-8">\n';
            html += '    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n';
            html += '    <title>' + settings.title + '</title>\n';
            html += '    <style>\n';
            html += '        * { margin: 0; padding: 0; box-sizing: border-box; }\n';
            html += '        body { font-family: \'Segoe UI\', Arial, sans-serif; background: linear-gradient(135deg, #eff6ff 0%, #e0e7ff 100%); direction: rtl; height: 100vh; overflow: hidden; }\n';
            html += '        .container { display: flex; height: 100vh; }\n';
            html += '        .sidebar { width: 320px; background: white; box-shadow: 2px 0 10px rgba(0,0,0,0.1); overflow-y: auto; }\n';
            html += '        .sidebar-header { background: linear-gradient(135deg, #2563eb 0%, #4f46e5 100%); color: white; padding: 20px; }\n';
            html += '        .sidebar-header h1 { font-size: 22px; font-weight: bold; margin-bottom: 6px; }\n';
            html += '        .sidebar-header .subtitle { color: #bfdbfe; font-size: 13px; }\n';
            html += '        .logos { display: flex; align-items: center; justify-content: center; gap: 15px; margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.2); }\n';
            html += '        .logos img { max-height: 35px; max-width: 120px; background: white; padding: 6px 10px; border-radius: 6px; object-fit: contain; }\n';
            html += '        .nav { padding: 16px; }\n';
            html += '        .nav-category { margin-bottom: 16px; }\n';
            html += '        .nav-category-title { font-size: 11px; font-weight: 600; color: #6b7280; text-transform: uppercase; padding: 0 8px; margin-bottom: 8px; }\n';
            html += '        .nav-item { display: flex; align-items: center; gap: 12px; padding: 12px 16px; border-radius: 8px; cursor: pointer; transition: all 0.2s; margin-bottom: 4px; color: #374151; width: 100%; font-size: 14px; font-weight: 500; border: none; background: none; text-align: right; }\n';
            html += '        .nav-item:hover { background: #f3f4f6; }\n';
            html += '        .nav-item.active { background: #2563eb; color: white; box-shadow: 0 4px 6px rgba(37, 99, 235, 0.3); }\n';
            html += '        .main-content { flex: 1; overflow-y: auto; padding: 20px; }\n';
            html += '        .content-wrapper { max-width: 1200px; margin: 0 auto; }\n';
            html += '        .header-card { background: white; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); padding: 20px 24px; margin-bottom: 16px; }\n';
            html += '        .header-title { font-size: 24px; font-weight: bold; color: #111827; margin-bottom: 4px; }\n';
            html += '        .screenshot-card { background: white; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); padding: 12px; margin-bottom: 16px; }\n';
            html += '        .screenshot-card img { width: 100%; height: auto; max-height: 700px; object-fit: contain; border-radius: 8px; display: block; background: #f9fafb; }\n';
            html += '        .text-card { background: white; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); padding: 32px; margin-bottom: 24px; }\n';
            html += '        .text-card p { color: #374151; font-size: 15px; line-height: 1.8; white-space: pre-line; }\n';
            html += '        .content-card { background: white; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); padding: 32px; }\n';
            html += '        .content-title { font-size: 20px; font-weight: bold; color: #111827; margin-bottom: 16px; }\n';
            html += '        .content-list { list-style: none; }\n';
            html += '        .content-list li { padding: 8px 0; color: #374151; line-height: 1.6; font-size: 15px; }\n';
            html += '        .content-list li::before { content: \'â€¢ \'; color: #2563eb; font-weight: bold; margin-left: 8px; }\n';
            html += '        .nav-buttons { display: flex; gap: 12px; margin-top: 24px; }\n';
            html += '        .nav-btn { padding: 12px 24px; border-radius: 8px; font-weight: 500; cursor: pointer; border: none; font-size: 14px; }\n';
            html += '        .nav-btn-prev { background: #e5e7eb; color: #374151; }\n';
            html += '        .nav-btn-prev:hover { background: #d1d5db; }\n';
            html += '        .nav-btn-next { background: #2563eb; color: white; }\n';
            html += '        .nav-btn-next:hover { background: #1d4ed8; }\n';
            html += '        @keyframes pulse { 0%, 100% { opacity: 1; transform: scale(1); } 50% { opacity: 0.8; transform: scale(1.05); } }\n';
            html += '        .animated { animation: pulse 1.5s ease-in-out infinite; }\n';
            html += '    </style>\n';
            html += '</head>\n';
            html += '<body>\n';
            html += '    <div class="container">\n';
            html += '        <div class="sidebar">\n';
            html += '            <div class="sidebar-header">\n';
            html += '                <h1>' + settings.title + '</h1>\n';
            html += '                <div class="subtitle">' + settings.subtitle + '</div>\n';
            if (settings.logo1 || settings.logo2) {
                html += '                <div class="logos">\n';
                if (settings.logo1) html += '                    <img src="' + settings.logo1 + '" alt="Logo 1">\n';
                if (settings.logo2) html += '                    <img src="' + settings.logo2 + '" alt="Logo 2">\n';
                html += '                </div>\n';
            }
            html += '            </div>\n';
            html += '            <div class="nav" id="navigation"></div>\n';
            html += '        </div>\n';
            html += '        <div class="main-content">\n';
            html += '            <div class="content-wrapper" id="mainContent"></div>\n';
            html += '        </div>\n';
            html += '    </div>\n';
            html += '    <script>\n';
            html += '        var screens = ' + screensJSON + ';\n';
            html += '        var categories = [];\n';
            html += '        var tempCats = {};\n';
            html += '        for (var i = 0; i < screens.length; i++) {\n';
            html += '            if (!tempCats[screens[i].category]) {\n';
            html += '                tempCats[screens[i].category] = true;\n';
            html += '                categories.push(screens[i].category);\n';
            html += '            }\n';
            html += '        }\n';
            html += '        var selectedId = 1;\n';
            html += '        function render() {\n';
            html += '            var navHTML = "";\n';
            html += '            for (var c = 0; c < categories.length; c++) {\n';
            html += '                var cat = categories[c];\n';
            html += '                navHTML += "<div class=\\"nav-category\\">";\n';
            html += '                navHTML += "<div class=\\"nav-category-title\\">" + cat + "</div>";\n';
            html += '                for (var s = 0; s < screens.length; s++) {\n';
            html += '                    if (screens[s].category === cat) {\n';
            html += '                        var activeClass = selectedId === screens[s].id ? " active" : "";\n';
            html += '                        navHTML += "<button class=\\"nav-item" + activeClass + "\\" onclick=\\"select(" + screens[s].id + ")\\">";\n';
            html += '                        navHTML += "<span>" + screens[s].icon + "</span>";\n';
            html += '                        navHTML += "<span>" + screens[s].title + "</span>";\n';
            html += '                        navHTML += "</button>";\n';
            html += '                    }\n';
            html += '                }\n';
            html += '                navHTML += "</div>";\n';
            html += '            }\n';
            html += '            document.getElementById("navigation").innerHTML = navHTML;\n';
            html += '            var screen = null;\n';
            html += '            var idx = -1;\n';
            html += '            for (var i = 0; i < screens.length; i++) {\n';
            html += '                if (screens[i].id === selectedId) {\n';
            html += '                    screen = screens[i];\n';
            html += '                    idx = i;\n';
            html += '                    break;\n';
            html += '                }\n';
            html += '            }\n';
            html += '            var contentHTML = "<div class=\\"header-card\\">";\n';
            html += '            contentHTML += "<h2 class=\\"header-title\\">" + screen.icon + " " + screen.title + "</h2>";\n';
            html += '            contentHTML += "</div>";\n';
            html += '            if (screen.textContent) {\n';
            html += '                contentHTML += "<div class=\\"text-card\\"><p>" + screen.textContent + "</p></div>";\n';
            html += '            } else if (screen.image) {\n';
            html += '                contentHTML += "<div class=\\"screenshot-card\\"><img src=\\"" + screen.image + "\\" alt=\\"" + screen.title + "\\"></div>";\n';
            html += '            }\n';
            html += '            if (screen.content && screen.content.length > 0) {\n';
            html += '                contentHTML += "<div class=\\"content-card\\">";\n';
            html += '                contentHTML += "<h3 class=\\"content-title\\">× ×§×•×“×•×ª ××¤×ª×—</h3>";\n';
            html += '                contentHTML += "<ul class=\\"content-list\\">";\n';
            html += '                for (var i = 0; i < screen.content.length; i++) {\n';
            html += '                    contentHTML += "<li>" + screen.content[i] + "</li>";\n';
            html += '                }\n';
            html += '                contentHTML += "</ul></div>";\n';
            html += '            }\n';
            html += '            contentHTML += "<div class=\\"nav-buttons\\">";\n';
            html += '            if (idx > 0) {\n';
            html += '                contentHTML += "<button class=\\"nav-btn nav-btn-prev\\" onclick=\\"select(" + screens[idx-1].id + ")\\">â† ×”×§×•×“×</button>";\n';
            html += '            }\n';
            html += '            if (idx < screens.length - 1) {\n';
            html += '                contentHTML += "<button class=\\"nav-btn nav-btn-next\\" onclick=\\"select(" + screens[idx+1].id + ")\\">×”×‘× â†’</button>";\n';
            html += '            }\n';
            html += '            contentHTML += "</div>";\n';
            html += '            document.getElementById("mainContent").innerHTML = contentHTML;\n';
            html += '        }\n';
            html += '        function select(id) {\n';
            html += '            selectedId = id;\n';
            html += '            render();\n';
            html += '            document.querySelector(".main-content").scrollTo(0, 0);\n';
            html += '        }\n';
            html += '        render();\n';
            html += '    <\/script>\n';
            html += '</body>\n';
            html += '</html>';
            
            return html;
        }
    </script>
</body>
</html>